---
title: "SNS投稿が面倒すぎたので、Discordの絵文字クリックだけで完結するようにした"
emoji: "🤖"
type: "tech"
topics: ["Discord", "LLM", "自動化", "SNS運用", "Python"]
published: false
---

## やりたかったこと

SNSの運用が続かない。

ネタを見つけて、下書きを書いて、推敲して、投稿する。この流れが重い。ブラウザで面白い記事を見つけても、そこから投稿文を書く気力が出ない。結局Discordにこれ面白いとURLを貼っておしまいになる。

だったらDiscordに貼ったURLを、絵文字1クリックで投稿まで持っていけないか。そう思って作り始めた。

## 全体の流れ

できたのは3フェーズのパイプラインだ。

**フェーズ1は収集。** Botが定期的にDiscordのチャンネルを巡回して、新しいメッセージに調査レベルの絵文字を付ける。⚡の軽めから🧪の深掘りまで4段階。気になった投稿の絵文字をポチッと押すだけでいい。

**フェーズ2は下書き生成。** クリックされたメッセージをBotが検知する。URLの中身を取りに行って、LLMに下書きを作らせる。できたドラフトは元メッセージのスレッドに投稿される。✅で承認、🚫で却下、✏️で修正依頼。

**フェーズ3は投稿。** ✅を押せばXに投稿される。✏️なら修正版をスレッドに書き込めば、そちらが投稿される。

普段のDiscordの使い方をほとんど変えずに、SNS投稿のパイプラインが回る。

## リアクションの数え方

Discordのリアクションカウントには少しクセがある。

Botが絵文字を追加した時点でカウントは1。ユーザーが押すと2になる。つまりcount 2以上なら人間が押したと判定できる。

ここに気づくまで少しハマった。Botの初期リアクションが常に1つ含まれる前提で設計しないといけない。

## LLMの2パス生成

ドラフト生成で工夫したのは、LLMを2回通すところだ。

1回目はテンプレートに沿った下書き生成。ペルソナや文体、文字数制限をプロンプトで指定する。テンプレートは用途別に複数ある。ニュース紹介用、カジュアルな感想用など切り替えが効く。

ただ1回目の出力はどうしてもAIっぽくなる。丁寧すぎる敬語。抽象的な表現の繰り返し。テンプレ感のある構成。そのまま投稿したらフォロワーに見抜かれる。

そこで2回目のパスとしてヒューマナイズを通す。口語体に書き直してカジュアルにする。80文字以内に圧縮し、URLは一旦外してあとから再付与。ハッシュタグは最大1つ。このルールをプロンプトに定義しておくと、人間が書いたような短い投稿に仕上がる。

なぜ2ステップに分けたか。それぞれ独立して改善できるからだ。テンプレートを差し替えても文体はブレない。ヒューマナイズのルールだけ直しても内容には響かない。

## URLだけ渡すとLLMが嘘をつく

開発中に厄介な問題にぶつかった。

DiscordのメッセージがURLだけだと、LLMがページの中身を勝手に想像して書く。存在しない機能紹介やスペックが平然と出てくる。

対策はシンプルで、LLMに渡す前にURLのメタデータを取得するステップを挟んだ。OGPのタイトルやdescription、ページ本文の一部を取り込んでから生成する。調査レベルが高いほど情報量を増やす仕組みで、⚡なら500文字、🧪なら2,000文字まで取り込む。

これでハルシネーションはほぼ消えた。プロンプト側でも元テキストに存在しない情報は書くなと制約をかけている。

## 日本語の文字数制限

Xの文字数制限は280文字だが、日本語は1文字2カウント。実質140文字が上限だ。URLは別カウントなので、本文を140文字に収めればいい。

とはいえギリギリを狙うと超過する。テンプレートでは100文字をターゲットにし、ヒューマナイズで80文字まで圧縮する。余裕を持たせて投稿失敗を防いでいる。

## 修正ワークフロー

下書きが微妙なとき、✏️を押すとスレッドで修正できる。修正版のメッセージに👍を付ければ、Botがそれを拾って投稿する。

最初は修正版をどう見分けるかで悩んだ。スレッド内の全メッセージを拾うと会話のノイズが混ざる。👍リアクションをマーカーにして、これが最終版だと明示する方式に落ち着いた。

## 状態管理

パイプラインの状態はJSONファイルで管理している。処理済みメッセージのID、保留中のドラフト、投稿済みのドラフトID。この3つを記録する。

気をつけたのは並行実行だ。GitHub Actionsのスケジュールトリガーで定期実行しているため、前の実行が終わる前に次が走ることがある。投稿直前にJSONを再読み込みし、すでに投稿済みならスキップする。完璧なロックではない。ただ個人用ならこれで十分だった。

古いドラフトは7日で自動削除。投稿済みリストは直近50件だけ保持する。放置しても膨らまない。

## スレッドのフォールバック

Discordのスレッド作成APIは古いメッセージに対して失敗することがある。

その場合はメッセージオブジェクトに既存スレッドがないか確認して、なければフォールバック用のレビューチャンネルに投稿する。収集から数時間後に処理が走るケースもあるので、このフォールバックには結構助けられている。

## 運用してみて

この仕組みを動かして数ヶ月。SNS投稿のハードルは明らかに下がった。

以前は記事を見つけて、投稿文を考えて、投稿するまで全部自分でやっていた。いまは記事を見つけたら絵文字を押す。下書きを確認して絵文字を押す。それで終わり。頭を使うのは下書きの良し悪しを判断するところだけだ。

もう一つ、投稿の品質が安定した。自分で書くとその日の気分で文体がバラつく。テンプレートとヒューマナイズを通すと、一定のトーンで投稿が出続ける。

## 技術スタック

- **言語** Python
- **Discord連携** discord.py（Bot API）
- **LLM** Claude Haiku（コスト重視）
- **SNS投稿** X API（Free tier、投稿のみ）
- **スケジューラ** GitHub Actions（schedule trigger）
- **状態管理** JSONファイル
- **設定管理** YAML + SOPS暗号化

## 課題

うまく回っている一方で、課題も見えてきた。

一番大きいのはメッセージ量だ。技術ニュースや業界ニュースのフィードもDiscordに流しているので、1日に数十件のメッセージがチャンネルに溜まる。全部に調査レベルの絵文字が付くから、自分がクリックしたメッセージが他に埋もれる。チャンネル数も増えてきた。Botの巡回範囲が広がるほどノイズも増える。

もう一つはスレッドの一覧性の低さだ。ドラフトはスレッドに投稿されるが、Discordのスレッドはわざわざ開かないと中身が見えない。通知が来ても後回しにして、そのまま忘れる。承認待ちのドラフトが数日放置されていることがある。どのスレッドが未承認なのか、一覧で確認する手段がない。パイプラインの状態はJSONに持っているのだから、承認待ちの一覧を別チャンネルにまとめて投稿するような仕組みが要るかもしれない。

## 設計で大事にしたこと

振り返ると、このワークフローがうまく回っている理由は3つある。

一つ目は既存の行動に乗せたこと。Discordに記事URLを貼る行為は以前からやっていた。そこに絵文字クリックを1つ足しただけだ。新しいツールを開くとか、専用のフォームに入力するとか、そういうステップは一切ない。

二つ目は人間の判断を最小限にしたこと。人間がやるのは投稿するかしないかの二択だけ。文面はLLMが作り、投稿はBotがやる。

三つ目は失敗してもダメージがないこと。却下すれば投稿されない。修正したければスレッドで直せる。間違って承認しても個人アカウントだから致命傷にはならない。この安全マージンがあるから、気軽に✅を押せる。

SNS運用を頑張るのではなく、普段の情報収集の延長で勝手に回る仕組みにする。そのためにDiscordの絵文字というゼロコストのインターフェースを選んだ。
